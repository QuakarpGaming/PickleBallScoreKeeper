<title>Hardest Part of the Sport!</title>
<header>
</header>
<style>
    body {
        background-color: black;
        color: white;
        width: 100%;
        overflow:hidden;
    }

    .scoreBox {
        border-radius: 5px;
        border-width: 5px;
        border-color: white;
        border-style: solid;
        display: flex;
        justify-content: center;
        align-items: center;
        width: 50%;
        height: 100%;
        flex-direction: column;
        margin: -5px;
    }
    .scoreBoxTwoDigits{
        margin-left: 10% !important;
    }

    .scoreInput {
        text-align: center;
        font-weight: bolder;
        background-color: black;
        color: white;
        width: 49%;
        font-size: 25vw;
        margin:auto;
    }

    .scoreInput-full {
        text-align: center;
        font-weight: bolder;
        background-color: black;
        color: white;
        width: 49%;
        font-size: 35vw;
        margin: auto;
    }

    .footer {
        width: 99%;
        height: fit-content;
        display: flex;
        flex-direction: row;
        justify-content: center;
    }

    .footerElement {
        width: 25%;
        border-width: 2px;
        border-color: white;
        border-style: solid;
        text-align: center;
        display: flex;
        justify-content: center;
        flex-wrap: nowrap;
        font-size: 5vw;
        align-items: center;
    }
    .footerElement-full {
        width: 25%;
        border-width: 2px;
        border-color: white;
        border-style: solid;
        text-align: center;
        display: flex;
        justify-content: center;
        flex-wrap: nowrap;
        font-size: calc(5rem + 5vw);
        align-items: center;
    }

    .scorebtn {
        width: 100%;
        font-size: 3vw;
    }

    .flex-row-Top {
        display: flex;
        flex-direction: row;
        width: 99%;
        height: 60%;
    }
    .flex-row-Top-full {
        display: flex;
        flex-direction: row;
        width: 99%;
        height: 80%;
    }
    .currentServer{
        background-color: white;
        color:black;
    }
    .phone{
        display: none;
    }
    .desktop {
        display: flex;
    }
    .flex-row-Bot {
        display: flex;
        flex-direction: row;
        width: 100%;
        height: 20%;
        justify-content:center;
    }
    .col-2{
        width:49%;
        margin:1em;
    }
    .arrow-btn{
        margin-bottom: 2vw;
    }
    .teamNameBox{
        display:flex;
        flex-direction:row;
        height:5%;
    }
    .team-name {
        display: inline-flex;
        width: 50%;
        min-height: 20%;
        font-size: xx-large;
        font-weight: bolder;
        background-color: black;
        color: white;
        text-shadow: -3px 0 black, 0 3px black, 3px 0 black, 0 -3px black;
        text-align:center;
        border:dotted 3px;
    }
    .circle {
        width: 1.5em; /* Adjust as needed */
        height: 1.5em; /* Adjust as needed */
        border-radius: 50%;
        background-color: #f0f0f0; /* Optional: Add a background color */
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 1.5em; /* Adjust as needed */
        color: #333; /* Optional: Adjust text color */
        position: absolute;
        top: 40%;
        left: 1%;
        transform: translateX(-1%);
    }
    .overlay {
        position: fixed;
        top: 0;
        bottom: 0;
        left: 0;
        right: 0;
        background: rgba(0, 0, 0, 0.7);
        transition: opacity 500ms;
        visibility: hidden;
        opacity: 0;
    }

        .overlay:target {
            visibility: visible;
            opacity: 1;
        }

    .popup {
        margin: 70px auto;
        padding: 20px;
        background: black;
        border-radius: 5px;
        width: 50%;
        position: relative;
        transition: all 5s ease-in-out;
        height: fit-content;
        border: dashed 1em;
        max-height: 80%;
    }

    .popup h2 {
        margin-top: 0;
        color: white;
        font-family: Tahoma, Arial, sans-serif;
    }

    .popup .close {
        position: absolute;
        top: 20px;
        right: 30px;
        transition: all 200ms;
        font-size: 3em;
        font-weight: bold;
        text-decoration: none;
        color: red;
    }

        .popup .close:hover {
            color: #06D85F;
        }

    .popup .content {
        max-height: 30%;
        overflow: auto;
    }

    .content {
        font-size: 2em;
    }
    .contentinput {
        background-color: wheat;
        text-align: center;
        font-size: 2em
    }
        .contentinputNumber{
        width:2.5em;
    }
    .contentinputCheckBox {
        height: 1em;
        width: 1em;
    }
    a {
        text-decoration: none;
    }
    td {
        font-size: 1.5vw;
    }
    input[list]::-webkit-calendar-picker-indicator {
        display: none !important;
    }
    ::placeholder {
        color: white; /* Example: Red color */
        opacity: 1; /* Fixes Firefox's default lower opacity */
    }
    @media only screen and (hover: none) and (pointer: coarse) {
        .scoreInput {
            text-align: center;
            font-weight: bolder;
            background-color: black;
            color: white;
            width: 49%;
            font-size: 20vw;
            margin: auto;
        }

        .flex-row-Top {
            display: flex;
            flex-direction: row;
            width: 99%;
            height: 80%;
        }

        .phone {
            display: flex;
        }

        .desktop {
            display: none;
        }

        .flex-row-Bot {
            display: none;
        }

        .footerElement {
            width: 25%;
            border-width: 2px;
            border-color: white;
            border-style: solid;
            text-align: center;
            display: flex;
            justify-content: center;
            flex-wrap: nowrap;
            font-size: larger;
            align-items: center;
        }

        .arrow-btn {
        }

        .team-name {
            display: none;
        }

        .teamNameBox {
            display: none;
        }

        .circle {
            display: none;
        }
    }
</style>
<html>
<body>
    
    <div class="flex-row-Top">
        <!--SETTING POPUP-->
        <div class="circle"><a class="button" href="#Settings" onclick="BlockKeyPress()">&#9881;</a></div>
        <div id="Settings" class="overlay">
            <div class="popup">
                <h2>Game Settings</h2>
                <a class="close" href="#" onclick="AllowKeyPress()">&times;</a>
                <div class="content">
                    <table style="border-spacing: 0 10px; ">
                        <tr>
                            <td>PlayTill:&nbsp;</td>
                            <td>
                                <input type="number" class="contentinput contentinputNumber" value="11" id="max" onfocusout="SetMaxPoints(this.value)" />
                            </td>
                        </tr>
                        <tr>
                            <td>Win By 2:&nbsp;</td>
                            <td><input type="checkbox" class="contentinput contentinputCheckBox" id="win" onchange="SetWinBy2(this.checked)" checked /></td>
                        </tr>
                        <tr>
                            <td>Allow Sound:&nbsp;</td>
                            <td><input type="checkbox" class="contentinput contentinputCheckBox" id="sounds" onchange="SetSounds(this.checked)" checked /></td>
                        </tr>
                    </table>
                </div>
                <hr />
                <div class="content">
                    <table>
                        <tr>
                            <td colspan="2">Current Server Order</td>
                        </tr>
                        <tr>
                            <td>Server 1:</td>
                            <td><label id="server1"></label></td>
                        </tr>
                        <tr>
                            <td colspan="2" style="text-align:center"><input type="button" onclick="swapServerNames()" value="&#8645;" style="width: 100%; font-size: 1.5vw;" /></td>
                        </tr>
                        <tr>
                            <td>Server 2:</td>
                            <td><label id="server2"></label></td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
        <!--END OF SETTING POPUP-->
        <div class='scoreBox'>
            <div class="teamNameBox">

                <input class="team-name" type="text" id="leftSideName1" onfocus="BlockKeyPress()" onfocusout="UpdateServerAndDataList(this.value)" placeholder="Server 1" list="names" tabindex="1"/>
                <p style="font-size:calc(4rem + 5vw); color:white;"></p>
                <input class="team-name" type="text" id="leftSideName2" onfocus="BlockKeyPress()" onfocusout="UpdateServerAndDataList(this.value)" placeholder="Server 2" list="names" tabindex="2"/>
            </div>
            <input class="scorebtn phone" type="button" value="&#8593;" onclick="UpScore('leftSide')" />
            <p class="scoreInput" readonly id="leftSide">0</p>
            <input class="scorebtn phone" type="button" value="&#8595;" onclick="DownScore('leftSide')" />
        </div>
        <div class='scoreBox'>
            <div class="teamNameBox">
                <input class="team-name" type="text" id="rightSideName1" onfocus="BlockKeyPress()" onfocusout="UpdateServerAndDataList(this.value)" placeholder="Server 1" list="names" tabindex="3"/>
                <p style="font-size:calc(4rem + 5vw); color:white;"></p> 
                <input class="team-name" type="text" id="rightSideName2" onfocus="BlockKeyPress()" onfocusout="UpdateServerAndDataList(this.value)" placeholder="Server 2" list="names"tabindex="4"/>
            </div>
            <input class="scorebtn phone" type="button" value="&#8593;" onclick="UpScore('rightSide')" />
            <p class="scoreInput" readonly id="rightSide">0</p>
            <input class="scorebtn phone" type="button" value="&#8595;" onclick="DownScore('rightSide')" />
        </div>
        
        <datalist id="names">
        </datalist>
    </div>
    <br />
    <div class="footer">
        <div class="footerElement" id="1">1st Server</div>
        <div class="footerElement" id="2">2nd Server</div>
        <div class="footerElement" id="3">1st Server</div>
        <div class="footerElement currentServer" id="4">2nd Server</div>
    </div>
    <div style="width:100%; display:block; align-content:center; height:9%;">
        <input class="scorebtn" id="NS" type="button" value="Next Server!" onclick="NextServer()" />
    </div>
    <div class="flex-row-Bot">
        <div class="col-2">
            <input class="scorebtn desktop arrow-btn" type="button" value="&#8593;" onclick="UpScore('leftSide')" />
            <input class="scorebtn desktop arrow-btn" type="button" value="&#8595;" onclick="DownScore('leftSide')" />
        </div>
        <div class="col-2">
            <input class="scorebtn desktop arrow-btn" type="button" value="&#8593;" onclick="UpScore('rightSide')" />
            <input class="scorebtn desktop arrow-btn" type="button" value="&#8595;" onclick="DownScore('rightSide')" />
        </div>
    </div>
</body>
</html>
<script>
    var hideBtns = true;
    var syth = window.speechSynthesis;
    var voices = syth.getVoices();
    var canSayScore = true;
    var canSaySideOut = true;
    var takeInput = true;
    var winningAmount = 11;
    var serverName1 = "";
    var serverName2 = "";
    var winByTwo = true;
    var allowSounds = true;
    var lastScoreRight = 0;
    var lastScoreLeft = 0;
    var lastStart = true;
    var sayServerName = true;
    document.addEventListener("DOMContentLoaded", (event) =>
    {
        var localHideBtns = window.localStorage.getItem("btns");
        if (localHideBtns != null) {
            hideBtns = localHideBtns !== "true";
            KeyPress("Escape");
        }

        var namesToLoadStr = window.localStorage.getItem("names")
        if (namesToLoadStr != null && namesToLoadStr.trim() != "") {
            var namesList = namesToLoadStr.split(',');
            var savedNames = document.getElementById("names");

            namesList.forEach(name => {
                var newOption = document.createElement("option");
                newOption.value = name;
                savedNames.appendChild(newOption);
            })
        }

        var winningPoints = parseInt(window.localStorage.getItem("winningAmount"));
        if (winningPoints != null && !isNaN(winningPoints)) {
            winningAmount = winningPoints;
            document.getElementById("max").value = winningAmount;
        }
        
        var winBy2Storage = window.localStorage.getItem("winBy2");
        if (winBy2Storage != null) {
            winByTwo = winBy2Storage == "true"
            document.getElementById("win").checked = winByTwo;
        }
        var useSoundsStorage = window.localStorage.getItem("useSounds");
        if (useSoundsStorage != null) {
            allowSounds = useSoundsStorage == "true"
            document.getElementById("sounds").checked = allowSounds;
        }
        document.querySelectorAll("input").forEach(x => {
            if (x.list == null) {
                x.tabIndex = -1;
            }
        })
    });

    document.addEventListener("keydown", KeyPress)
    function SetMaxPoints(points) {
        winningAmount = parseInt(points)
        window.localStorage.setItem("winningAmount", points);

    }
    function SetWinBy2(checked) {
        winByTwo = checked;
        window.localStorage.setItem("winBy2", checked);
    }
    function SetSounds(checked) {
        allowSounds = checked
        window.localStorage.setItem("useSounds", checked);

    }
    function BlockKeyPress() {
        takeInput = false;
    }
    function AllowKeyPress(setNames = false) {
        takeInput = true;
        if(setNames)
            SetServerNames(true)
    }
    function SetServerNames(start = false) {
        var current = document.getElementsByClassName("currentServer")[0];
        if (current.id == "3" || current.id == "4") {
            var sideEle = document.getElementById("rightSide");
            score = parseInt(sideEle.innerHTML);
            if (score % 2 == 0 && !start) {
                serverName1 = document.getElementById("rightSideName1").value;
                serverName2 = document.getElementById("rightSideName2").value;
            }
            else {
                serverName1 = document.getElementById("rightSideName2").value;
                serverName2 = document.getElementById("rightSideName1").value;
            }
        }
        else {
            var sideEle = document.getElementById("leftSide");
            score = parseInt(sideEle.innerHTML);
            if (score % 2 == 0) {
                serverName1 = document.getElementById("leftSideName1").value;
                serverName2 = document.getElementById("leftSideName2").value;
            }
            else {
                serverName1 = document.getElementById("leftSideName2").value;
                serverName2 = document.getElementById("leftSideName1").value;
            }
        }
        document.getElementById("server1").innerHTML = serverName1;
        document.getElementById("server2").innerHTML = serverName2;

    }
    function UpdateServerAndDataList(newName) {
        takeInput = true;
        SetServerNames(true);
        if (newName != null && newName != "") {
            newName = newName.trim();
            newName = newName.charAt(0).toUpperCase() + newName.slice(1);

            var savedNames = document.getElementById("names");
            if (!(Array.from(savedNames.options).some(option => option.value === newName))) {  
                var option = document.createElement('option');
                option.value = newName;
                savedNames.appendChild(option); 
                ReorderSavedNames();
            }
        }
    }
    function ReorderSavedNames() {
        var savedNames = document.getElementById("names");
        var options = Array.from(savedNames.options);
        options.sort((a, b) => {
            return a.value.localeCompare(b.value);
        });
        savedNames.innerHTML = '';

        options.forEach(o => {
            savedNames.appendChild(o)
        });
        updateLocalNamesList();
    }

    function updateLocalNamesList() {
        var savedNames = document.getElementById("names");
        var options = Array.from(savedNames.options);
        var saveString = '';
        options.forEach(o => {
            saveString += (o.value + ',');
        })
        window.localStorage.setItem("names", saveString);
    }
    function swapServerNames() {
        var newfirst = serverName2;
        var newSecond = serverName1;

        serverName1 = newfirst;
        serverName2 = newSecond;
        document.getElementById("server1").innerHTML = serverName1;
        document.getElementById("server2").innerHTML = serverName2;
        sayServerName = true;
    }
    function SetServerNamesBackButton() {
        var current = document.getElementsByClassName("currentServer")[0];
        if (current.id == "3" || current.id == "4") {
            var sideEle = document.getElementById("rightSide");
            score = parseInt(lastScoreRight);
            if (score % 2 == 0 && !lastStart) {
                serverName1 = document.getElementById("rightSideName1").value;
                serverName2 = document.getElementById("rightSideName2").value;
            }
            else {
                serverName1 = document.getElementById("rightSideName2").value;
                serverName2 = document.getElementById("rightSideName1").value;
            }
        }
        else {
            var sideEle = document.getElementById("leftSide");
            score = parseInt(lastScoreLeft);
            if (score % 2 == 0) {
                serverName1 = document.getElementById("leftSideName1").value;
                serverName2 = document.getElementById("leftSideName2").value;
            }
            else {
                serverName1 = document.getElementById("leftSideName2").value;
                serverName2 = document.getElementById("leftSideName1").value;
            }
        }
    }
    function KeyPress(e) {
        if (takeInput) {
            if (e.code === "PageDown") {
                winningAmount = 9;
            }
            else if (e.code === "PageUp") {
                winningAmount = 11;
            }
            else if (e.code === "Space") {
                ReadScore();
            }
            else if (e.code === "ArrowUp") {
                var currentServer = document.getElementsByClassName("currentServer")[0].id;
                if (currentServer === "1" || currentServer === "2") {
                    UpScore('leftSide');
                }
                else {
                    UpScore('rightSide');
                }
            }
            else if (e.code === "ArrowDown") {
                var currentServer = document.getElementsByClassName("currentServer")[0].id;
                if (currentServer === "1" || currentServer === "2") {
                    DownScore('leftSide');
                }
                else {
                    DownScore('rightSide');
                }
            }
            else if (e.code === "ArrowRight") {
                NextServer();
            }
            else if (e.code === "ArrowLeft") {
                LastServer();
            }
            else if (e.code === "Backquote" || e.code === "Escape" || e === "Escape") {
                var btns = document.getElementsByClassName("scorebtn desktop arrow-btn");;
                for (var i = 0; i < btns.length; i++) {

                    if (hideBtns) {
                        btns[i].style.display = "none"
                    }
                    else {
                        btns[i].style.display = "flex"
                    }
                }
                if (hideBtns) {
                    document.getElementById("NS").style.display = "none"
                    var boxes = document.getElementsByClassName("flex-row-Top");
                    while (boxes.length != 0) {
                        boxes[boxes.length - 1].classList.add("flex-row-Top-full");
                        boxes[boxes.length - 1].classList.remove("flex-row-Top");
                    }

                    var scores = document.getElementsByClassName("scoreInput")
                    while (scores.length != 0) {
                        scores[scores.length - 1].classList.add("scoreInput-full");
                        scores[scores.length - 1].classList.remove("scoreInput");
                    }

                    var footerText = document.getElementsByClassName("footerElement");
                    while (footerText.length != 0) {
                        footerText[footerText.length - 1].classList.add("footerElement-full");
                        footerText[footerText.length - 1].classList.remove("footerElement");
                    }
                }
                else {
                    document.getElementById("NS").style.display = "flex"
                    var boxes = document.getElementsByClassName("flex-row-Top-full");
                    while (boxes.length != 0) {
                        boxes[boxes.length - 1].classList.add("flex-row-Top");
                        boxes[boxes.length - 1].classList.remove("flex-row-Top-full");
                    }

                    var scores = document.getElementsByClassName("scoreInput-full")
                    while (scores.length != 0) {
                        scores[scores.length - 1].classList.add("scoreInput");
                        scores[scores.length - 1].classList.remove("scoreInput-full");
                    }

                    var footerText = document.getElementsByClassName("footerElement-full");
                    while (footerText.length != 0) {
                        footerText[footerText.length - 1].classList.add("footerElement");
                        footerText[footerText.length - 1].classList.remove("footerElement-full");
                    }
                }
                hideBtns = !hideBtns;
                window.localStorage.setItem("btns", hideBtns)
            }
            else if (e.code == "KeyH") {

            }
        }
    }
    function UpScore(side)
    {
        var sideEle = document.getElementById(side);
        var currentScore = parseInt(sideEle.innerHTML);
        
        currentScore += 1;
        if (currentScore >= 10) {
            sideEle.classList.add("scoreBoxTwoDigits");
        }
        sideEle.innerHTML = currentScore.toString();
        if (currentScore >= winningAmount) {
            var otherScore;
            if (side == "leftSide") {
                var otherside = document.getElementById("rightSide");
                otherScore = parseInt(otherside.innerHTML);
            }
            else {
                var otherside = document.getElementById("leftSide");
                otherScore = parseInt(otherside.innerHTML);
            }

            if(!winByTwo || currentScore - otherScore >= 2)
                DeclareWinner(side);
        }
    }
    function DownScore(side) {
        var sideEle = document.getElementById(side);
        var currentScore = parseInt(sideEle.innerHTML);
        if (currentScore != 0)
            currentScore -= 1;
        if (currentScore < 10)
            sideEle.classList.remove("scoreBoxTwoDigits");
        sideEle.innerHTML = currentScore.toString();
    }
    function NextServer()
    {
        var current = document.getElementsByClassName("currentServer")[0];
        var currnetScore = 0
        sayServerName = true;
        current.classList.remove("currentServer");
        if (current.id == "1") {
            document.getElementById("2").classList.add("currentServer");
        }
        else if (current.id == "2") {
            document.getElementById("3").classList.add("currentServer");
            SideOut(current.id)
            lastScoreLeft = parseInt(document.getElementById("leftSide").innerHTML);
            lastStart = false;
        }
        else if (current.id == "3") {
            document.getElementById("4").classList.add("currentServer");
        }
        else if (current.id == "4") {
            document.getElementById("1").classList.add("currentServer");
            SideOut(current.id)
            lastScoreRight = parseInt(document.getElementById("rightSide").innerHTML);
        }
    }
    function SideOut(serverNumber) {
        SetServerNames();
        if (canSaySideOut && allowSounds) {
            canSaySideOut = false;
            var whatToSay = new SpeechSynthesisUtterance("SIDE OUT");
            whatToSay.voice = voices[5];
            syth.speak(whatToSay);
            ReadScore();
            setTimeout(function () { canSaySideOut = true; }, 5000);
        }
    }
    function LastServer() {
        var current = document.getElementsByClassName("currentServer")[0];
        sayServerName = true;
        current.classList.remove("currentServer");
        if (current.id == "1") {
            document.getElementById("4").classList.add("currentServer");
            SetServerNamesBackButton();
        }
        else if (current.id == "2") {
            document.getElementById("1").classList.add("currentServer");
        }
        else if (current.id == "3") {
            document.getElementById("2").classList.add("currentServer");
            SetServerNamesBackButton();
        }
        else if (current.id == "4") {
            document.getElementById("3").classList.add("currentServer");
        }
    }
    function ReadScore() {
        if (canSayScore && allowSounds) {
            canSayScore = false;
            var score1 = "";
            var score2 = "";
            var left = document.getElementById("leftSide").innerHTML;
            var right = document.getElementById("rightSide").innerHTML;
            var current = document.getElementsByClassName("currentServer")[0];
            var voices = syth.getVoices();
            if (current.id == "1" || current.id == "2") {
                score1 = left;
                score2 = right;
            }
            else {
                score1 = right;
                score2 = left;
            }
            var serverNumber = "";
            if (current.id == "1" || current.id == "3") {
                serverNumber = "1"
            }
            else {
                serverNumber = "2"
            }

            var serverNameToSay = ""
            if (current.id == "1" || current.id == "3") serverNameToSay = serverName1;
            else serverNameToSay = serverName2
            var strWhatToSay
            if (sayServerName && serverNameToSay != null && serverNameToSay != "") {
                sayServerName = false;
                strWhatToSay = score1 + '. ' + score2 + '. ' + serverNumber + '. ' + serverNameToSay + " to serve";
            }
            else {
                strWhatToSay = score1 + '. ' + score2 + '. ' + serverNumber + '. ';
            }
            var whatToSay = new SpeechSynthesisUtterance(strWhatToSay);
            whatToSay.voice = voices[5]; 
            syth.speak(whatToSay);
            setTimeout(function () {
                canSayScore = true;
            }, 3000);
        }
    }
    function DeclareWinner(side) {
        if (allowSounds) {
            var name1 = document.getElementById(side + "Name1").value
            var name2 = document.getElementById(side + "Name2").value

            var whatToSay = new SpeechSynthesisUtterance(name1 + " & " + name2 + " have won the set!");
            whatToSay.voice = voices[5];
            syth.speak(whatToSay);
        }
    }
</script>

<!--

<span id="left11">&#8592;</span>
    span id="left12">&#8594;</span>
-->
